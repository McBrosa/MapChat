<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    
    <h:head>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no"></meta>
        <meta charset="utf-8"></meta>
        <style>
            html, body {
              height: 100%;
              margin: 0;
              padding: 0;
            }
            #map {
              height: 100%;
            }
          </style>
    </h:head>
    <h:body>
        <p:growl id="messages" showDetail="true" />
        <p:gmap widgetVar="map" center="0,0" zoom="18" fitBounds="true" type="HYBRID" style="width:100%;height:400px"
            model="#{addMarkersView.emptyModel}" onPointClick="handlePointClick(event);" />
        <!--<p:gmap center="36.890257,30.707417" zoom="13" type="HYBRID" style="width:100%;height:400px" model="#{markersView.simpleModel}" />-->
        <h:form id="formId">
            <h:inputHidden id="latitude" value="#{accountManager.selected.locationX}"/>
            <h:inputHidden id="longitude" value="#{accountManager.selected.locationY}"/>
            <h:commandButton id="update" action="#{accountManager.updateLocation()}" value="Update Location" rendered="true" />               
        </h:form>
        <script type="text/javascript">
            var currentMarker = null;
            if (navigator.geolocation) {
                checkGeolocationByHTML5();
            } else {
                checkGeolocationByLoaderAPI(); // HTML5 not supported! Fall back to Loader API.
            }

            function checkGeolocationByHTML5() {
                navigator.geolocation.getCurrentPosition(function(position) {
                    setMapCenter(position.coords.latitude, position.coords.longitude);
                }, function() {
                    checkGeolocationByLoaderAPI(); // Error! Fall back to Loader API.
                });
            }

            function checkGeolocationByLoaderAPI() {
                if (google.loader.ClientLocation) {
                    setMapCenter(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);
                } else {
                    // Unsupported! Show error/warning?
                }
            }

            function setMapCenter(latitude, longitude) {
                PF('map').getMap().setCenter(new google.maps.LatLng(latitude, longitude));
                document.getElementById('formId:latitude').value = latitude;
                document.getElementById('formId:longitude').value = longitude;
                currentMarker = new google.maps.Marker({
                    position:new google.maps.LatLng(latitude, longitude)
                });
                PF('map').addOverlay(currentMarker);
            }
        </script>
    </h:body>    
</html>