<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js" />
    
    <h:body>
        <ui:composition template="/template/siteTemplate.xhtml">
            <!-- A user must be logged in to access chat, therefore the header must be changed to reflect this -->
            <ui:define name="header">
                <ui:include src="/template/userHeaderTemplate.xhtml" />
            </ui:define>
            
            <ui:define name="editableContent">
                <div id="group">
                    <h:form id="groups-buttons-form-1">
                        <h:panelGrid id="modal-button-panel" columns="1" cellpadding="0">
                            <p:commandButton class="show-button" value="Create Group" type="button" onclick="PF('createGroupDlg').show();PF('addUserDlg').hide();PF('removeUserDlg').hide();"/>
                            <p:commandButton class="show-button" value="Add User" type="button" onclick="PF('createGroupDlg').hide();PF('addUserDlg').show();PF('removeUserDlg').hide();"/>
                            <p:commandButton class="show-button" value="Remove User" type="button" onclick="PF('createGroupDlg').hide();PF('addUserDlg').hide();PF('removeUserDlg').show();"/>
                        </h:panelGrid>
                    </h:form>
                    <ui:include src="groups.xhtml" />
               </div>
                <h:panelGroup id="map">
                    <ui:include src="Map.xhtml"/>
                </h:panelGroup>
                <div id="chat">
                    <ui:include src="chat/chat.xhtml"/>
                </div>
                <h:form id="groups-buttons-form-2">
                <p:remoteCommand name="refreshMap" action="#{markersView.refreshMap()}" update=":gmap" />
                    
                    <p:dialog closable="false" position="top" header="Create Group" widgetVar="createGroupDlg" height="150">
                        <h:outputLabel styleClass="outputLabel" for="newgroupname" value="Enter group name: " />
                        <h:inputText class="form-control"  id="newgroupname" value="#{groupManager.groupNameToCreate}"/>
                        <br />
                        <br />
                        <p:commandButton class="groups-button" id="createGroup-btn"  value="Create Group" action="#{groupManager.createGroup()}" update=":select_group:global_groups error1 newgroupname">
                            <p:ajax event="click" onsuccess="refreshMap()" />
                        </p:commandButton>
                        <br />
                        <br />
                        <p:commandButton value="Close" onclick="PF('createGroupDlg').hide();" actionListener="#{groupManager.closeDialog()}" update="error1 newgroupname"/>
                        <h:outputLabel id="error1" value="#{groupManager.statusMessage}"  style="color:red"/>
                    </p:dialog>
                    
                    <p:dialog closable="false" position="top" header="Add User" widgetVar="addUserDlg" height="150">
                        <h:outputLabel styleClass="outputLabel" for="addusername" value="Enter username: " />
                        <h:inputText class="form-control"  id="addusername" value="#{groupManager.usernameToAdd}"/>
                        <br />
                        <br />
                        <p:commandButton class="groups-button" id="addUser-btn" value="Add User" action="#{groupManager.addUser()}" update="error2 addusername">
                            <p:ajax event="click" onsuccess="refreshMap()" />
                        </p:commandButton>
                        <br />
                        <br />
                        <p:commandButton value="Close" onclick="PF('addUserDlg').hide();" actionListener="#{groupManager.closeDialog()}" update="error2 addusername"/>
                        <h:outputLabel id="error2" value="#{groupManager.statusMessage}"  style="color:red"/>
                    </p:dialog>
                    
                    <p:dialog closable="false" position="top" header="Remove User" widgetVar="removeUserDlg" height="150">
                        <h:outputLabel styleClass="outputLabel" for="removeusername" value="Enter username: " />
                        <h:inputText class="form-control"  id="removeusername" value="#{groupManager.usernameToDelete}"/>
                        <br />
                        <br />
                        <p:commandButton class="groups-button" id="removeUser-btn" value="Remove User" action="#{groupManager.removeUser()}" update=":select_group:global_groups error3 removeusername">
                            <p:ajax event="click" onsuccess="refreshMap()" />
                        </p:commandButton>
                        <br />
                        <br />
                        <p:commandButton value="Close" onclick="PF('removeUserDlg').hide();" actionListener="#{groupManager.closeDialog()}" update="error3 removeusername"/>
                        <h:outputLabel id="error3" value="#{groupManager.statusMessage}"  style="color:red"/>
                    </p:dialog>
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
